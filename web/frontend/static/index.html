<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>Cookmate</title>
    <style>
        body { font-family: sans-serif; margin: 0; }
        header { background: #333; color: #fff; padding: 10px 20px; display:flex; align-items:center; }
        header h1 { margin: 0; font-size: 20px; }
        nav ul { list-style:none; margin:0; padding:0; display:flex; }
        nav li { margin-right:15px; }
        nav a { color:#fff; text-decoration:none; padding:4px 8px; }
        nav a.active { background:#555; border-radius:4px; }
        section { padding:20px; display:none; }
        section.active { display:block; }
        table { border-collapse:collapse; width:100%; margin-top:20px; }
        th, td { border:1px solid #ccc; padding:4px 8px; }
    </style>
</head>
<body>
    <header>
        <h1>Cookmate</h1>
        <nav>
            <ul>
                <li><a href="#recipes" class="active">菜谱</a></li>
                <li><a href="#inventory">库存</a></li>
                <li><a href="#planner">筛选</a></li>
            </ul>
        </nav>
    </header>
    <section id="recipes" class="active">
        <h2>菜谱</h2>
        <button id="load-recipes">加载菜谱</button>
        <ul id="recipes-list"></ul>
    </section>
    <section id="inventory">
        <h2>库存</h2>
        <button id="load-inv">加载库存</button>
        <ul id="inv-list"></ul>
    </section>
    <section id="planner">
        <h2>智能筛选</h2>
        <button id="check-cookable">可做菜</button>
        <ul id="cookable-list"></ul>
    </section>

    <script>
    document.querySelectorAll('nav a').forEach(a => {
        a.addEventListener('click', e => {
            e.preventDefault();
            document.querySelectorAll('nav a').forEach(n => n.classList.remove('active'));
            a.classList.add('active');
            document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
            const id = a.getAttribute('href').substring(1);
            document.getElementById(id).classList.add('active');
        });
    });
    document.getElementById('load-recipes').addEventListener('click', async () => {
        const resp = await fetch('/recipes/');
        const data = await resp.json();
        document.getElementById('recipes-list').innerHTML = data.map(r => `<li>${r} <button data-r="${r}">删除</button></li>`).join('');
    });
    document.getElementById('recipes-list').addEventListener('click', async (e) => {
        if (e.target.tagName === 'BUTTON') {
            const name = e.target.getAttribute('data-r');
            const resp = await fetch(`/recipes/${name}`, {method: 'DELETE'});
            if (resp.status === 204) e.target.parentElement.remove();
        }
    });
    document.getElementById('load-inv').addEventListener('click', async () => {
        const resp = await fetch('/inventory/');
        const data = await resp.json();
        document.getElementById('inv-list').innerHTML = data.map(i => `<li>${i.ingredient}: ${i.amount} ${i.unit} <button data-i="${i.ingredient}">删除</button></li>`).join('');
    });
    document.getElementById('inv-list').addEventListener('click', async (e) => {
        if (e.target.tagName === 'BUTTON') {
            const ing = e.target.getAttribute('data-i');
            const resp = await fetch(`/inventory/${ing}`, {method: 'DELETE'});
            if (resp.status === 204) e.target.parentElement.remove();
        }
    });
    document.getElementById('check-cookable').addEventListener('click', async () => {
        const resp = await fetch('/planner/cookable');
        const data = await resp.json();
        document.getElementById('cookable-list').innerHTML = data.map(r => `<li>${r}</li>`).join('');
    });
    </script>
</body>
</html>
